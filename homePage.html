<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans&family=Poppins&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css" integrity="sha384-3B6NwesSXE7YJlcLI9RpRqGf2p/EgVH8BgoKTaUrmKNDkHPStTQ3EyoYjCGXaOTS" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="css/styles.css">
  <title>FaceBook</title>
</head>

<body>
  <div class="home-page-container">
    <div class="menu-container">

      <div class="user-profile-menu">
        <img src="pp.png" width="70px" height="70px" alt="" id="user-menu-img">
        <div class="user-menu-name-email">
          <p id="user-menu-name"></p>
          <p id="user-menu-email"></p>
        </div>
      </div>
      <div class="menu-items">
        <ul>
          <div class="menu-item" id="post">
            <li><i class="fa-solid fa-pen-to-square fa-2x"></i>post</li>
          </div>
          <div class="menu-item" id="newsfeed">
            <li><i class="fa-solid fa-newspaper fa-2x"></i>newsfeed</li>
          </div>
          <div class="menu-item" id="friends">
            <li><i class="fa-solid fa-user-group fa-2x"></i>friends</li>
          </div>
          <div class="menu-item" id="profile">
            <li><i class="fa-solid fa-user fa-2x"></i>profile</li>
          </div>
        </ul>
      </div>
      <div class="menu-logout" id="logout">
        <i class="fa-solid fa-right-from-bracket fa-lg"></i>
        <p>Log Out</p>
      </div>
    </div>
    <div class="pages-container" id="pagesContainer">

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script type="text/javascript">
    window.onload = () => {

      var pagesContainer = document.getElementById('pagesContainer')

      document.getElementById('post').addEventListener('click', navigateWritePost)
      document.getElementById('friends').addEventListener('click', navigateFriends)
      document.getElementById('newsfeed').addEventListener('click', navigateNewsFeed)
      document.getElementById('profile').addEventListener('click', navigateProfile)
      document.getElementById('logout').addEventListener('click', logout)

      var user_id = window.localStorage.getItem('user_id')
      var user_email = window.localStorage.getItem('user_email')
      var user_name = window.localStorage.getItem('user_name')

      setMenuProfile()

      function setMenuProfile() {
        document.getElementById('user-menu-name').innerText = user_name
        document.getElementById('user-menu-email').innerText = user_email
      }

      async function fetchAPI(url, obj) {
        await axios.post(url, obj)
          .then(async (resp) => {
            console.log(resp)
            return resp
          })
          .catch((e) => {
            console.log(e)
          })
      }

      async function navigateFriends() {

        let url = 'http://localhost/facebook/facebook/api/friends.php'
        let object = {
          'id': user_id
        }
        let data = await axios.post(url, object)
          .then(async (resp) => {
            return resp.data
          })
          .catch((e) => {
            console.log(e)
          })
        console.log(data)

        pagesContainer.innerHTML = '<div class="friends-requests-btn" id="requests"><i class="fa-solid fa-bell fa-lg"></i><p>Requests</p></div>'
        var i = 1
        while (data['user' + i]) {
          let friend = data['user' + i]
          pagesContainer.innerHTML += '<div class="friend-container" id="' + friend['id'] + '">' +
            '<div class="user-profile">' +
            '<div class="user-image-name-date">' +
            '<img src="./pp.png" width="10%" height="auto" alt="">' +
            '<div class="user-name-date">' +
            '<p>' + friend['name'] + '</p><p>' + friend['email'] + '</p>' +
            '</div></div></div></div>'
          i = i + 1
        }

        document.getElementById('requests').addEventListener('click',getRequests)

        async function getRequests()
        {
          let url = 'http://localhost/facebook/facebook/api/getFriendsRequests.php'
          let object = {
            'id': user_id
          }
          let data = await axios.post(url, object)
            .then(async (resp) => {
              return resp.data
            })
            .catch((e) => {
              console.log(e)
            })
            console.log(data)
            pagesContainer.innerHTML = ''
            var i = 1
            while (data['request' + i]) {
              let friend = data['request' + i]
                pagesContainer.innerHTML += '<div class="friend-container" id="' + friend['id'] + '">' +
                '<div class="user-profile">' +
                '<div class="user-image-name-date">' +
                '<img src="./pp.png" width="10%" height="auto" alt="">' +
                '<div class="user-name-date">' +
                '<p>' + friend['name'] + '</p><p>' + friend['email'] + '</p>' +
                '</div></div>'+
                '<div class="accept-reject"><div id="accept">'+
                '<i class="fa-solid fa-circle-check fa-lg"></i><p>accept</p></div>'+
                '<div id="reject"><i class="fa-solid fa-xmark fa-lg"></i><p>reject</p>'+
                '</div></div></div></div>'
              i = i + 1
            }
        }

      }


      async function navigateProfile() {

        let url = 'http://localhost/facebook/facebook/api/userPosts.php'
        let object = {
          'id': user_id
        }
        let data = await axios.post(url, object)
          .then(async (resp) => {
            // console.log(resp)
            return resp.data
          })
          .catch((e) => {
            console.log(e)
          })
        console.log(data)

        var i = 1
        while (data['post' + i]) {
          let post = data['post' + i];
          pagesContainer.innerHTML += '<div class="post-container">' +
            '<div class="user-profile">' +
            '<div class="user-image-name-date">' +
            '<img src="./pp.png" width="10%" height="auto" alt="">' +
            '<div class="user-name-date">' +
            '<p>ahmad nrdn</p><p>' + post['post_date'] + '</p>' +
            '</div></div>' +
            '<div id="' + post['id'] + '"><i class="fa-solid fa-pen fa-2x"></i></div></div>' +
            '<div class="post-text">' +
            '<p>' + post['text'] + '</p>' +
            '</div>' +
            '</div>'
          i = i + 1
        }

      }

      async function navigateNewsFeed() {

        let url = 'http://localhost/facebook/facebook/api/friendsPosts.php'
        let object = {
          'id': user_id
        }
        let data = await axios.post(url, object)
          .then(async (resp) => {
            // console.log(resp)
            return resp.data
          })
          .catch((e) => {
            console.log(e)
          })
        console.log(data)
        pagesContainer.innerHTML = ''
        var i = 1
        while (data['post' + i]) {
          let post = data['post' + i]
          pagesContainer.innerHTML += '<div class="post-container">' +
            '<div class="user-profile">' +
            '<div class="user-image-name-date">' +
            '<img src="./pp.png" width="10%" height="auto" alt="">' +
            '<div class="user-name-date">' +
            '<p class="post-user-name">' + post['name'] + '</p><p class="post-date">' + post['post_date'] + '</p>' +
            '</div></div></div>' +
            '<div class="post-text">' +
            '<p>' + post['text'] + '</p>' +
            '<p><i class="fa-solid fa-thumbs-up"></i>&nbsp;Likes ' + post['likes'] + '</p>' +
            '</div>' +
            '</div>'
          i = i + 1
        }
      }

      async function navigateWritePost() {

        pagesContainer.innerHTML = ''

        pagesContainer.innerHTML += '<div class="write-post-container">' +
          '<div class="post-input">' +
          '<input type="text" name="" value="" id="input-post">' +
          '</div>' +
          '<button type="button" name="button" id="user-post-btn">Post</button>' +
          '</div>'

        document.getElementById('user-post-btn').addEventListener('click', postTodb)

        async function postTodb() {
          let text = document.getElementById('input-post').value
          let url = 'http://localhost/facebook/facebook/api/writePost.php'
          let object = {
            'user_id': user_id,
            'text': text
          }
          let data = await axios.post(url, object)
            .then(async (resp) => {
              console.log("post sent successfully")
              return resp.data
            })
            .catch((e) => {
              console.log(e)
            })
          console.log(data)
        }
      }

      function logout() {
        console.log('clicked logout')
        window.localStorage.clear()
        window.location.href = "http://localhost/facebook/facebook/login.html"
      }

    }
  </script>
</body>

</html>
